Запуск системы

Скопировать содержимое репозитория -> git clone https://github.com/bot-tg-simple/final_calculator
Затем переходим в директорию final_calculator -> cd final_calculator
Затем подгружаем все нужные библиотеки -> go mod download
Запускаем главный файл программы -> go run main.go
После открываем файл index.html(можно открыть папку и щёлкнуть пару раз на index.html) и вычисляем согласно дальнейшей инструкции. По всем вопросам -> контакты в ТГ ниже(в самом конце).
Ещё есть схема программы в SCHEME.md

Также есть написанные тесты, их можно запустить так -> go test
Во время тестов в консоли будут выводиться пояснения с небольшой задержкой(5 секунд), чтобы можно было прочитать те действия, которые программа сейчас тестирует. Сначала пойдут модульные тесты, затем - интеграционные.


Программа предоставляет веб-интерфейс. 

JWT токен, который выдаётся после авторизации сохраняется в локальном хранилище браузера(localstorage), так что вставлять его никуда не надо и при работе на сайте вам он непосредственно выдаваться не будет. Токен действителен только 5 минут, поэтому после программа может потребовать повторной аутентификации.

Программа работает в контексте конкретного пользователя(ищет выражения только того пользователя, который сейчас авторизован и также добавляет на его имя выражения). Всё хранится в базе данных.

Есть страницы:
1) Калькулятор(можно ввести выражение и получить его ID и приблизительное время выполнения, но только если вы зарегистрированы и авторизованы)

2) Поиск по ID(вводите скопированный ID вашего добавленного выражения со страницы "Калькулятор" без пробелов и получаете всю информацию о вашем выражении)

3) Выражения(можно нажать на кнопку "Check" и увидеть всю информацию о всех своих добавленных выражениях(ищет все добавленные выражения на имя авторизованного пользователя))

4) Настройка расчёта(страница пока не работает, так что изменять время выполнения операций надо через curl запрос)

5) Вычислительные ресурсы(по кнопке "Check" можно узнать время выполнения последней операции на сервере)

6) Workers(Мониторинг воркеров. Выдаёт информацию(ID выражения и время его выполнения) о выполняющихся и выполненных выражениях(время "-1" - выражение посчитано))

7) Регистрация(Регистрация пользователя)

8) Войти(Авторизация(аутентификация) пользователя(jwt токен сохраняется в локальном хранилище браузера(localstorage) и не выдаётся))

9) Тесты(они доступны в редакторе и запустить их можно по команде -> go test)


### Документация по API

#### 1. `/expression`

Эндпоинт позволяет добавить новое математическое выражение для вычисления.

- **Метод:** POST
- **Параметры запроса:**
  - `expression` (обязательный): Математическое выражение для вычисления.
  - `jwt` (обязательный): JWT токен для аутентификации пользователя.
- **Ответ:**
  - `expression`: Добавленное математическое выражение.
  - `id`: Уникальный идентификатор добавленного выражения.
  - `status`: Статус выражения (выполняется/выполнено).
  - `approximate_time`: Приблизительное время выполнения выражения (в секундах).

Пример curl запроса:

'%2B' = '+' в URL кодировке

curl -X POST http://localhost:8080/expression -d "expression=2%2B(2*2)/(2-1)*9-40&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTM3MjE4NTcsImlhdCI6MTcxMzcyMTU1NywibmFtZSI6ImV4YW1wbGUiLCJuYmYiOjE3MTM3MjE1NTd9.STr42Z6UARc9st5S3vQvLqDu5zZLY1V1xYIPdR5MYFs"

Пример ответа:

{"approximate_time":0,"expression":"2+(2*2)/(2-1)*9-40","id":"560948a0-93bb-4bdf-ba19-54c3d4df7f51","status":"выполняется"}

#### 2. `/id-expression`

Эндпоинт позволяет получить информацию о математическом выражении по его уникальному идентификатору.

- **Метод:** POST
- **Параметры запроса:**
  - `id` (обязательный): Уникальный идентификатор математического выражения.
  - `jwt` (обязательный): JWT токен для аутентификации пользователя.
- **Ответ:**
  - `id`: Уникальный идентификатор выражения.
  - `expression`: Математическое выражение.
  - `login`: Логин пользователя, который добавил выражение.
  - `status`: Статус выражения (выполняется/выполнено).
  - `created_at`: Время создания выражения.
  - `updated_at`: Время последнего обновления выражения.
  - `result`: Результат вычисления выражения.

Пример curl запроса:

curl -X POST http://localhost:8080/id-expression -d "id=42c47b77-4fce-4729-bde6-b7395a5de94b&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTM3MjE4NTcsImlhdCI6MTcxMzcyMTU1NywibmFtZSI6ImV4YW1wbGUiLCJuYmYiOjE3MTM3MjE1NTd9.STr42Z6UARc9st5S3vQvLqDu5zZLY1V1xYIPdR5MYFs"

Пример ответа:

{"created_at":"2024-04-21T20:36:03.92843+03:00","expression":"2-2","id":"42c47b77-4fce-4729-bde6-b7395a5de94b","login":"example","result":"0","status":"выполнено","updated_at":"2024-04-21T20:36:03.930601+03:00"}

#### 3. `/expressions`

Эндпоинт позволяет получить список всех математических выражений пользователя.

- **Метод:** POST
- **Параметры запроса:**
  - `jwt` (обязательный): JWT токен для аутентификации пользователя.
- **Ответ:**
  - `expressions`: Список объектов выражений, содержащих поля:
    - `id`: Уникальный идентификатор выражения.
    - `expression`: Математическое выражение.
    - `login`: Логин пользователя, который добавил выражение.
    - `status`: Статус выражения (выполняется/выполнено).
    - `created_at`: Время создания выражения.
    - `updated_at`: Время последнего обновления выражения.
    - `result`: Результат вычисления выражения.

Пример curl запроса:

curl -X POST http://localhost:8080/expressions -d "jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTM3MjEwMDcsImlhdCI6MTcxMzcyMDcwNywibmFtZSI6ImV4YW1wbGUiLCJuYmYiOjE3MTM3MjA3MDd9.EZJb5oHbcWkbNnw4MgkMNLRtp6FIaKz8sTXt7Itz3C0"

Пример ответа:

{"expressions":[{"ID":"42c47b77-4fce-4729-bde6-b7395a5de94b","Expression":"2-2","LoginUser":"example","Status":"выполнено","CreatedAt":"2024-04-21T20:36:03.92843+03:00","UpdatedAt":"2024-04-21T20:36:03.930601+03:00","Result":"0"}]}

#### 4. `/login`

Эндпоинт позволяет аутентифицировать пользователя и выдать ему JWT токен.

- **Метод:** POST
- **Параметры запроса:**
  - `login` (обязательный): Логин пользователя.
  - `password` (обязательный): Пароль пользователя.
- **Ответ:**
  - `authentication`: Статус аутентификации (успешно/неуспешно).
  - `JWT`: JWT токен для аутентифицированного пользователя.

Пример curl запроса:

1) curl -X POST http://localhost:8080/login -d "login=example&password=pass123"

2) curl -X POST http://localhost:8080/login -d "login=123&password=pass123" (несуществующий пользователь)

Пример ответа: 

1) {"JWT":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTM3MjEwMDcsImlhdCI6MTcxMzcyMDcwNywibmFtZSI6ImV4YW1wbGUiLCJuYmYiOjE3MTM3MjA3MDd9.EZJb5oHbcWkbNnw4MgkMNLRtp6FIaKz8sTXt7Itz3C0","authentication":"Successfully authentication!"}

2) {"authentication":"Incorrect password or login"}

#### 5. `/register`

Эндпоинт позволяет зарегистрировать нового пользователя.

- **Метод:** POST
- **Параметры запроса:**
  - `login` (обязательный): Логин нового пользователя.
  - `password` (обязательный): Пароль нового пользователя.
- **Ответ:**
  - `message`: Сообщение о результате операции (успешно/неуспешно).

Пример curl запроса:

1) curl -X POST http://localhost:8080/register -d "login=example&password=pass123"

2) curl -X POST http://localhost:8080/register -d "login=&password=" (логин и пароль пустой)

Пример ответа:

1) {"message":"Successfully!"}

2) {"message":"Login and password should not be empty!"}

#### 6. `/ping`

Эндпоинт возвращает информацию о времени последнего запроса.

- **Метод:** GET
- **Ответ:**
  - `info`: Время последнего запроса.

Пример curl запроса:

curl -X GET http://localhost:8080/ping

Пример ответа:

{"info":"2024-04-21 20:13:55"}

#### 7. `/workers`

Эндпоинт позволяет получить информацию о работающих вычислительных процессах.

- **Метод:** GET
- **Ответ:**
  - `expressions`: Список идентификаторов выражений и их продолжительности выполнения.(если время "-1" - выражение уже посчиталось)

Пример curl запроса:

curl -X GET http://localhost:8080/workers

Пример ответа:

{"expressions":{}} - если операций никаких не выполняется

{"expressions":{"0e52ea3c-b771-4ef3-8e72-0cf5c5bdb9af":10}} - выполняется выражение с продолжительностью 10 секунд

{"expressions":{"0e52ea3c-b771-4ef3-8e72-0cf5c5bdb9af":-1,"640fe1a6-21de-4034-993e-63643aad4774":-1}} - два выражения вычислены

#### 8. `/duration`

Эндпоинт позволяет обновить продолжительность выполнения определенной математической операции.

- **Метод:** POST
- **Параметры запроса:**
  - `operation` (обязательный): Название операции (+, -, *, /).
  - `duration` (обязательный): Новая продолжительность выполнения операции (в секундах).
- **Ответ:**
  - `message`: Сообщение о результате операции (успешно/неуспешно).
  - `operations`: Обновленные данные о продолжительности выполнения операций.

Пример curl запроса:

* '%2B' = '+' в URL кодировке

curl -X POST http://localhost:8080/duration -d "operation=%2B&duration=6"

Пример ответа:

{"message":"Продолжительность обновлена","operations":[{"Name":"+","Duration":6,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"-","Duration":10,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"*","Duration":15,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"/","Duration":100,"StartTime":"0001-01-01T00:00:00Z","Status":""}]}

#### 9. `/operations`

Эндпоинт возвращает список доступных математических операций и их продолжительности выполнения по умолчанию.

- **Метод:** GET
- **Ответ:**
  - `operations`: Список доступных математических операций и их продолжительности выполнения по умолчанию.

Пример curl запроса:

curl -X GET http://localhost:8080/operations

Пример ответа:

{"operations":[{"Name":"+","Duration":5,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"-","Duration":10,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"*","Duration":15,"StartTime":"0001-01-01T00:00:00Z","Status":""},{"Name":"/","Duration":100,"StartTime":"0001-01-01T00:00:00Z","Status":""}]}


Контакты телеграмм для связи -> https://t.me/piters_boy
